#include <stdio.h>

#include "./print_arr.h"

// Функция сортировки методом сдвига с записью в файл
void shiftSort(int A[], int N, FILE *f) {
    printf("=== НАЧАЛО СОРТИРОВКИ (Метод сдвига) ===\n");
    if(f) fprintf(f, "=== НАЧАЛО СОРТИРОВКИ (Метод сдвига) ===\n");

    for (int i = 1; i < N; i++) {
        int t = A[i];
        int j = i - 1;
        
        // Логирование шага
        printf("ШАГ i=%d: Взяли элемент t = %d. Сравниваем с левой частью.\n", i, t);
        if(f) fprintf(f, "ШАГ i=%d: Взяли элемент t = %d. Сравниваем с левой частью.\n", i, t);

        while (j >= 0 && A[j] > t) {
            printf("  -> Сравнение: A[%d](%d) > t(%d) -- ИСТИНА. Сдвигаем %d вправо.\n", j, A[j], t, A[j]);
            if(f) fprintf(f, "  -> Сравнение: A[%d](%d) > t(%d) -- ИСТИНА. Сдвигаем %d вправо.\n", j, A[j], t, A[j]);
            
            A[j + 1] = A[j];
            j = j - 1;
        }

        if (j >= 0) {
             printf("  -> Сравнение: A[%d](%d) > t(%d) -- ЛОЖЬ. Место найдено.\n", j, A[j], t);
             if(f) fprintf(f, "  -> Сравнение: A[%d](%d) > t(%d) -- ЛОЖЬ. Место найдено.\n", j, A[j], t);
        } else {
             printf("  -> Достигнуто начало массива (j=-1).\n");
             if(f) fprintf(f, "  -> Достигнуто начало массива (j=-1).\n");
        }

        A[j + 1] = t;
        
        printf("  => Вставка t(%d) в позицию A[%d].\n", t, j + 1);
        if(f) fprintf(f, "  => Вставка t(%d) в позицию A[%d].\n", t, j + 1);
        
        printf("Результат после шага i=%d: ", i);
        if(f) fprintf(f, "Результат после шага i=%d: ", i);
        
        printArray(A, N, f); // Выводим массив и на экран, и в файл
        
        printf("\n--------------------------------------------------\n");
        if(f) fprintf(f, "\n--------------------------------------------------\n");
    }
    printf("=== СОРТИРОВКА ЗАВЕРШЕНА ===\n");
    if(f) fprintf(f, "=== СОРТИРОВКА ЗАВЕРШЕНА ===\n");
}